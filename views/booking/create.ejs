<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Book Helper - UrbanMaid</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
  <%- include('../partials/navbar', { user: user }) %>
  <main class="py-4">
    <div class="container">
      <div class="mx-auto mt-4" style="max-width:600px;">
        <div class="card shadow border-2" style="border-radius:1.5em;">
          <div class="card-header text-center bg-primary text-white" style="border-radius:1.3em 1.3em 0 0;">
            <i class="fas fa-calendar-plus me-2"></i> Book Service
          </div>
          <div class="card-body">
            <% if (helper) { %>
              <div class="d-flex align-items-center gap-4 flex-wrap mb-4 bg-light p-3 rounded-3">
                <img src="<%= helper.imageURL %>" alt="<%= helper.name %>" class="rounded-circle shadow" style="width:72px;height:72px;object-fit:cover;border:2.5px solid #d7eaff;" />
                <div>
                  <div class="fw-bold fs-5 mb-1"><%= helper.name %></div>
                  <div class="text-primary mb-1">
                    <%= helper.category %> • ₹<%= helper.hourlyRate %>/hour
                  </div>
                  <div class="text-muted small">
                    <i class="fas fa-map-marker-alt me-1"></i> <%= helper.location.area %>, <%= helper.location.city %>
                  </div>
                </div>
              </div>
            <% } %>

            <% if (typeof error !== 'undefined' && error) { %>
              <div class="alert alert-danger py-2 px-3 mb-3" role="alert">
                <i class="fa-solid fa-triangle-exclamation me-2"></i><%= error %>
              </div>
            <% } %>

            <form action="/booking" method="POST" autocomplete="off">
              <% if (helper) { %>
                <input type="hidden" name="helperId" value="<%= helper._id %>" />
              <% } %>

              <div class="row g-3">
                <div class="col-md-6">
                  <label for="bookingDate" class="form-label">Date *</label>
                  <input type="date" id="bookingDate" name="bookingDate" required class="form-control" value="" />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Start Time *</label>
                  <div class="d-flex gap-2">
                    <input type="number" id="startHour" name="startHour" min="1" max="12" placeholder="HH" required class="form-control" style="width:33%;" value="" />
                    <input type="number" id="startMinute" name="startMinute" min="0" max="59" placeholder="MM" required class="form-control" style="width:33%;" value="" />
                    <select id="ampm" name="ampm" required class="form-select" style="width:34%;">
                      <option value="AM">AM</option>
                      <option value="PM">PM</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="row g-3 mt-3">
                <div class="col-md-6">
                  <label for="duration" class="form-label">Duration (hours) *</label>
                  <select id="duration" name="duration" required class="form-select">
                    <option value="">Select duration</option>
                    <% [1,2,3,4,6,8].forEach(function(hour) { %>
                      <option value="<%= hour %>"><%= hour %> hour<%= hour > 1 ? 's' : '' %></option>
                    <% }); %>
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="totalAmount" class="form-label">Total Amount</label>
                  <input type="text" id="totalAmount" readonly placeholder="Select duration to see total" class="form-control bg-light" value="" />
                </div>
              </div>

              <div class="mt-4 mb-1 fw-semibold">Service Address *</div>
              <div class="row g-3">
                <div class="col-12">
                  <input type="text" name="street" class="form-control mb-2" placeholder="Street address" required value="" />
                </div>
                <div class="col-md-4">
                  <input type="text" name="area" class="form-control" placeholder="Area/Locality" value="" />
                </div>
                <div class="col-md-5">
                  <input type="text" name="city" class="form-control" placeholder="City" required value="" />
                </div>
                <div class="col-md-3">
                  <input type="text" name="pincode" class="form-control" placeholder="Pincode" pattern="[0-9]{6}" maxlength="6" value="" />
                </div>
              </div>

              <div class="mt-4">
                <label for="instructions" class="form-label">Special Instructions</label>
                <textarea id="instructions" name="instructions" rows="3" placeholder="Any specific requirements..." class="form-control"></textarea>
              </div>

              <div class="mt-4">
                <button type="submit" class="btn btn-primary w-100 fw-bold fs-5 py-2">
                  <i class="fas fa-check me-2"></i>Confirm Booking
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </main>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var duration = document.getElementById('duration');
      var totalAmount = document.getElementById('totalAmount');
      var rate = parseInt('<%= helper ? helper.hourlyRate : 0 %>') || 0;
      if (duration && totalAmount) {
        duration.addEventListener('change', function () {
          if (duration.value && !isNaN(rate)) {
            totalAmount.value = "₹" + (parseInt(duration.value) * rate);
          } else {
            totalAmount.value = "";
          }
        });
        if (duration.value && !isNaN(rate)) {
          totalAmount.value = "₹" + (parseInt(duration.value) * rate);
        }
      }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
